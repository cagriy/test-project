steps:




    - label: ':ecs: QA :rocket:'
      command: |
          CLUSTER_STACK_NAME=qa-ecs \
          TARGET_ENV=qa \
          CNAME=qa-smctest2.gapgov.uk \
          SERVICE_NAME=smctest2 \
          CPU=100 \
          MEMORY=256 \
          DOCKER_IMAGE=smctest2:latest \
          AWS_ENV=qa \
          make create
      env:
          TARGET_ENV: qa
      agents:
          queue: default

    - wait

    - label: ':ecs: PERF :rocket:'
      command: |
          SVCNT=$(buildkite-agent meta-data get "ecsservicecount") \
          TASKREV=$(buildkite-agent meta-data get "ecstaskrev") \
          make ecs-updateservice
      env:
          TARGET_ENV: perf
      agents:
          queue: default

    - block: ":rocket: Release!"

    - label: ':ecs: ETE :rocket:'
      command: |
          SVCNT=$(buildkite-agent meta-data get "ecsservicecount") \
          TASKREV=$(buildkite-agent meta-data get "ecstaskrev") \
          make ecs-updateservice
      env:
          TARGET_ENV: ete
      agents:
          queue: default



env:
    SERVICE_NAME: smctest
